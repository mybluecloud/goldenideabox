<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.triz.goldenideabox.dao.PatentMapper">
  <resultMap id="BaseResultMap" type="com.triz.goldenideabox.model.Patent">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="time" jdbcType="DATE" property="time" />
    <result column="state" jdbcType="INTEGER" property="state" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, creator, time, template_id, order_id, state
  </sql>
  <insert id="appointPatent" parameterType="java.lang.Integer">
    insert into t_patent (creator, time,
    order_id, state
    )
    values
    <foreach collection="orderIDs" item="orderID" open="(" close=")" separator="), (">
      #{userID,jdbcType=INTEGER},CURDATE(),#{orderID,jdbcType=INTEGER},0
    </foreach>
  </insert>
  <select id="getNoClaimPatent"  resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from t_patent
    where template_id is null
  </select>
  <update id="applyTemplate" parameterType="java.lang.Integer">
    update t_patent
    <set>
      <if test="templateID != null">
        template_id = #{templateID,jdbcType=INTEGER},
      </if>
    </set>
    where id = #{patentID,jdbcType=INTEGER}
  </update>
  <select id ="getPatents"  statementType="CALLABLE" resultType="com.alibaba.fastjson.JSONObject">
    <![CDATA[
            {call get_patent_list(#{userId, mode=IN, jdbcType=INTEGER},#{templateId, mode=IN, jdbcType=INTEGER},
            #{filter, mode=IN, jdbcType=VARCHAR},#{start, mode=IN, jdbcType=INTEGER},#{length, mode=IN, jdbcType=INTEGER},
            #{orderIndex, mode=IN, jdbcType=VARCHAR},#{order, mode=IN, jdbcType=VARCHAR},#{search, mode=IN, jdbcType=VARCHAR}
            )}
        ]]>
  </select >
  <select id ="getPatentCount"  statementType="CALLABLE" resultType="java.lang.Integer">
    <![CDATA[
            {call get_patent_count(#{userId, mode=IN, jdbcType=INTEGER},#{templateId, mode=IN, jdbcType=INTEGER},
            #{filter, mode=IN, jdbcType=VARCHAR},#{search, mode=IN, jdbcType=VARCHAR})}
        ]]>
  </select >
  <insert id="newPatent" parameterType="com.triz.goldenideabox.model.Patent"  useGeneratedKeys="true" keyProperty="id">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into t_patent ( creator, time,
    state
    )
    values ( #{creator.id,jdbcType=INTEGER}, CURDATE(),0
    )
  </insert>
  <select id="getPatentByID" parameterType="java.lang.Integer"  resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from t_patent
    where id = #{patentId,jdbcType=INTEGER}
  </select>
  <select id="getPatentNewID"   resultType="java.lang.Integer">
    select ifnull(max(id)+1,1) from t_patent
  </select>
  <select id="getPatentByOrderID" parameterType="java.lang.Integer"  resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from t_patent
    where order_id = #{patentId,jdbcType=INTEGER}
  </select>
  <insert id="importPatent" parameterType="com.triz.goldenideabox.model.Patent">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into t_patent (id, creator,template_id, time,
    state
    )
    values ( #{id,jdbcType=INTEGER},#{creator.id,jdbcType=INTEGER},#{template.id,jdbcType=INTEGER}, CURDATE(),0
    )
  </insert>
</mapper>